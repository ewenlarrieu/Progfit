# Progfit Backend API

Backend pour l'application Progfit - Plateforme de suivi de programmes sportifs.

## ğŸš€ Installation et dÃ©marrage

### PrÃ©requis

- Node.js (v18+)
- MongoDB
- Gmail avec mot de passe d'application

### Installation

```bash
npm install
```

### Configuration

CrÃ©ez un fichier `.env` avec :

```env
PORT=5000
MONGO_URL=votre-url-mongodb
JWT_SECRET=votre-secret-jwt
EMAIL_USER=votre-email@gmail.com
EMAIL_PASS=votre-mot-de-passe-app
CLIENT_URL=http://localhost:3000
```

### DÃ©marrage

```bash
npm start
```

Le serveur tourne sur `http://localhost:5000`

## ğŸ“‹ API Documentation

### ğŸ” Authentification

#### Inscription

**POST** `/api/auth/register`

**Body (JSON) :**

```json
{
  "username": "John Doe",
  "email": "john@example.com",
  "password": "MonMotDePasse123!",
  "confirmPassword": "MonMotDePasse123!"
}
```

**RÃ©ponse succÃ¨s (201) :**

```json
{
  "message": "Compte crÃ©Ã© avec succÃ¨s ! VÃ©rifiez votre email pour activer votre compte.",
  "user": {
    "id": "64f1234567890abcdef",
    "nom": "John Doe",
    "email": "john@example.com",
    "emailVerified": false
  }
}
```

**Erreurs possibles :**

- `400` : Champs manquants, mots de passe diffÃ©rents, format email invalide, mot de passe faible, email dÃ©jÃ  utilisÃ©
- `500` : Erreur serveur ou envoi email

**Validation mot de passe :**

- Minimum 8 caractÃ¨res
- Au moins 1 majuscule
- Au moins 1 minuscule
- Au moins 1 chiffre
- Au moins 1 caractÃ¨re spÃ©cial

#### VÃ©rification Email

**GET** `/api/auth/verify-email/:token`

**ParamÃ¨tres :**

- `token` : Token reÃ§u par email

**RÃ©ponse succÃ¨s (200) :**
Page HTML avec confirmation + token JWT pour tests

**Erreurs possibles :**

- `400` : Token invalide, expirÃ© ou compte dÃ©jÃ  vÃ©rifiÃ©

#### Mise Ã  jour du profil

**PUT** `/api/auth/update-profile`

**Headers :**

```
Authorization: Bearer <jwt_token>
Content-Type: application/json
```

**Body (JSON) :**

```json
{
  "niveau": "intermediaire",
  "objectifs": ["prise de masse", "force"]
}
```

**RÃ©ponse succÃ¨s (200) :**

```json
{
  "message": "Profil mis Ã  jour avec succÃ¨s !",
  "user": {
    "id": "64f1234567890abcdef",
    "nom": "John Doe",
    "email": "john@example.com",
    "niveau": "intermediaire",
    "objectifs": ["prise de masse", "force"],
    "profileCompleted": true,
    "emailVerified": true
  }
}
```

**Options disponibles :**

- **Niveaux** : `debutant`, `intermediaire`, `avance`
- **Objectifs** : `perte de poids`, `prise de masse`, `entretien`, `force`

**Erreurs possibles :**

- `401` : Token manquant ou invalide
- `400` : Niveau ou objectifs invalides
- `404` : Utilisateur non trouvÃ©

## ğŸ”§ Test avec Insomnia

### 1. Test d'inscription

```
POST http://localhost:5000/api/auth/register
Content-Type: application/json

{
  "username": "Test User",
  "email": "test@example.com",
  "password": "TestPass123!",
  "confirmPassword": "TestPass123!"
}
```

### 2. VÃ©rification email

1. VÃ©rifiez votre boÃ®te mail
2. Cliquez sur le lien de vÃ©rification
3. Copiez le token JWT affichÃ© sur la page
4. Ou testez directement : `GET http://localhost:5000/api/auth/verify-email/TOKEN`

### 3. Test mise Ã  jour profil

```
PUT http://localhost:5000/api/auth/update-profile
Authorization: Bearer <COLLER_LE_TOKEN_JWT_ICI>
Content-Type: application/json

{
  "niveau": "avance",
  "objectifs": ["prise de masse", "force"]
}
```

### 4. Tests d'erreurs

```json
// Mots de passe diffÃ©rents
{
  "username": "Test",
  "email": "test@example.com",
  "password": "TestPass123!",
  "confirmPassword": "AutrePass456!"
}

// Email invalide
{
  "username": "Test",
  "email": "email-invalide",
  "password": "TestPass123!",
  "confirmPassword": "TestPass123!"
}

// Mot de passe faible
{
  "username": "Test",
  "email": "test@example.com",
  "password": "123",
  "confirmPassword": "123"
}

// Champs manquants
{
  "username": "Test",
  "email": "test@example.com",
  "password": "TestPass123!"
  // confirmPassword manquant
}
```

## ğŸ“ Structure du projet

```
back-end/
â”œâ”€â”€ controllers/
â”‚   â””â”€â”€ authController.js      # Logique d'authentification
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ User.js               # ModÃ¨le utilisateur
â”‚   â”œâ”€â”€ Programme.js          # ModÃ¨le programme sportif
â”‚   â”œâ”€â”€ Exercice.js           # ModÃ¨le exercice
â”‚   â””â”€â”€ Progression.js        # ModÃ¨le suivi progression
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ authRoutes.js         # Routes d'authentification
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ email.js              # Service d'envoi d'emails + HTML pages
â”‚   â””â”€â”€ verifyPW.js           # Validation mot de passe
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ exercices.json        # DonnÃ©es exercices (Ã  complÃ©ter)
â”‚   â””â”€â”€ programmes.json       # DonnÃ©es programmes (Ã  complÃ©ter)
â”œâ”€â”€ .env                      # Variables d'environnement
â”œâ”€â”€ app.js                    # Configuration serveur
â””â”€â”€ package.json              # DÃ©pendances
```

## ğŸ›¡ï¸ SÃ©curitÃ©

- âœ… Hachage bcrypt des mots de passe
- âœ… Confirmation de mot de passe obligatoire
- âœ… Validation stricte des entrÃ©es
- âœ… Protection CORS activÃ©e
- âœ… VÃ©rification email obligatoire
- âœ… Tokens JWT avec expiration (7 jours)
- âœ… Sanitisation des donnÃ©es (trim, lowercase)
- âœ… Code modulaire et sÃ©curisÃ©

## ğŸ”„ Prochaines Ã©tapes

1. ImplÃ©menter la fonction `login` complÃ¨te
2. CrÃ©er middleware d'authentification rÃ©utilisable
3. DÃ©velopper les routes programmes/exercices
4. Ajouter systÃ¨me de reset mot de passe
5. Optimiser les validations avec middleware
6. CrÃ©er le frontend React

## ğŸ—ï¸ Architecture

Le code suit une architecture modulaire avec sÃ©paration des responsabilitÃ©s :

- **Controllers** : Logique mÃ©tier et validation
- **Models** : SchÃ©mas de donnÃ©es MongoDB
- **Utils** : Services rÃ©utilisables (email, validation)
- **Routes** : Configuration des endpoints API

## ğŸ§ª Workflow complet de test

1. **Inscription** â†’ Email de vÃ©rification envoyÃ©
2. **VÃ©rification email** â†’ Compte activÃ© + Token JWT rÃ©cupÃ©rÃ©
3. **Mise Ã  jour profil** â†’ Niveau et objectifs dÃ©finis
4. **Utilisateur complet** â†’ PrÃªt pour l'utilisation

## ğŸ› Debug

Pour voir les logs dÃ©taillÃ©s, activez le mode debug dans `authController.js` en ajoutant des `console.log()`.

---

**Auteur :** Ewen Larrieu  
**Version :** 2.0.0 - Authentification complÃ¨te avec profil utilisateur
